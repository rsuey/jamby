<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <script src="./onAirStatus_files/rpc.js"></script>
    <script src="./onAirStatus_files/hangout.js"></script>
    <script src="./onAirStatus_files/jquery.min.js"></script>
  </head>
  <body style="padding: 10px">
    <script>
      function registerWithJamby() {
        var hangoutUrl = gapi.hangout.getHangoutUrl(),
            youtubeId = gapi.hangout.onair.getYouTubeLiveId(),
            sessionId = gapi.hangout.getStartData();

        $.ajax("/group_sessions/" + sessionId + "/ready.json", {
          type: 'POST',
          dataType: "json",
          data: "hangoutUrl=" + hangoutUrl + "&youtubeId=" + youtubeId
        }).done(function(data, status, xhr) { heartbeat(sessionId); });
      }

      function heartbeat(id) {
        url = '/group_sessions/' + id + '/ping';
        $('body').append(url);
        $.ajax(url, { type: 'PUT' });
        setTimeout(heartbeat(id), 15 * 60);
      }

      gapi.hangout.onApiReady.add(function(eventObj) { registerWithJamby(); });
    </script>
    <h1>Thank you for hosting your session on Jamby!</h1>
    <h2>Press the little Jamby lightning bolt logo on the left, and remember to Start Broadcast!</h2>
  </body>
</html>
